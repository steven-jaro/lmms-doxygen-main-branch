<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LMMS: Porting from FLAC 1.1.2 to 1.1.3</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LMMS
   </div>
   <div id="projectbrief">Linux MultiMedia Studio - Complete Codebase</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('group__porting__1__1__2__to__1__1__3.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Porting from FLAC 1.1.2 to 1.1.3 <div class="ingroups"><a class="el" href="group__porting.html">Porting Guide for New Versions</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>This module describes porting from FLAC 1.1.2 to FLAC 1.1.3.  
</p>
<div class="dynheader">
Collaboration diagram for Porting from FLAC 1.1.2 to 1.1.3:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="group__porting__1__1__2__to__1__1__3.svg" width="364" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<p>This module describes porting from FLAC 1.1.2 to FLAC 1.1.3. </p>
<p>The main change between the APIs in 1.1.2 and 1.1.3 is that they have been simplified. First, libOggFLAC has been merged into libFLAC and libOggFLAC++ has been merged into libFLAC++. Second, both the three decoding layers and three encoding layers have been merged into a single stream decoder and stream encoder. That is, the functionality of FLAC__SeekableStreamDecoder and FLAC__FileDecoder has been merged into <a class="el" href="structFLAC____StreamDecoder.html">FLAC__StreamDecoder</a>, and FLAC__SeekableStreamEncoder and FLAC__FileEncoder into <a class="el" href="structFLAC____StreamEncoder.html">FLAC__StreamEncoder</a>. Only the <a class="el" href="structFLAC____StreamDecoder.html">FLAC__StreamDecoder</a> and <a class="el" href="structFLAC____StreamEncoder.html">FLAC__StreamEncoder</a> remain. What this means is there is now a single API that can be used to encode or decode streams to/from native FLAC or Ogg FLAC and the single API can work on both seekable and non-seekable streams.</p>
<p>Instead of creating an encoder or decoder of a certain layer, now the client will always create a <a class="el" href="structFLAC____StreamEncoder.html">FLAC__StreamEncoder</a> or <a class="el" href="structFLAC____StreamDecoder.html">FLAC__StreamDecoder</a>. The old layers are now differentiated by the initialization function. For example, for the decoder, FLAC__stream_decoder_init() has been replaced by <a class="el" href="group__flac__stream__decoder.html#ga32c28a56a2bdfa2333edbd3d991894d7">FLAC__stream_decoder_init_stream()</a>. This init function takes callbacks for the I/O, and the seeking callbacks are optional. This allows the client to use the same object for seekable and non-seekable streams. For decoding a FLAC file directly, the client can use <a class="el" href="group__flac__stream__decoder.html#ga1692108a97012d1c5f79baf7df012c33">FLAC__stream_decoder_init_file()</a> and pass just a filename and fewer callbacks; most of the other callbacks are supplied internally. For situations where fopen()ing by filename is not possible (e.g. Unicode filenames on Windows) the client can instead open the file itself and supply the FILE* to <a class="el" href="group__flac__stream__decoder.html#ga38f9eb46bf112af205f86b4cbac9980c">FLAC__stream_decoder_init_FILE()</a>. The init functions now returns a <a class="el" href="group__flac__stream__decoder.html#gaaed54a24ac6310d29c5cafba79759c44">FLAC__StreamDecoderInitStatus</a> instead of <a class="el" href="group__flac__stream__decoder.html#ga3adb6891c5871a87cd5bbae6c770ba2d">FLAC__StreamDecoderState</a>. Since the callbacks and client data are now passed to the init function, the FLAC__stream_decoder_set_*_callback() functions and FLAC__stream_decoder_set_client_data() are no longer needed. The rest of the calls to the decoder are the same as before.</p>
<p>There are counterpart init functions for Ogg FLAC, e.g. <a class="el" href="group__flac__stream__decoder.html#ga78bf285b54e5aaee73a214c108683a72">FLAC__stream_decoder_init_ogg_stream()</a>. All the rest of the calls and callbacks are the same as for native FLAC.</p>
<p>As an example, in FLAC 1.1.2 a seekable stream decoder would have been set up like so:</p>
<div class="fragment"><div class="line">FLAC__SeekableStreamDecoder *decoder = FLAC__seekable_stream_decoder_new();</div>
<div class="line"><span class="keywordflow">if</span>(decoder == <a class="code hl_define" href="CarlaBridgeFormat_8cpp.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) do_something;</div>
<div class="line">FLAC__seekable_stream_decoder_set_md5_checking(decoder, <span class="keyword">true</span>);</div>
<div class="line">[... other settings ...]</div>
<div class="line">FLAC__seekable_stream_decoder_set_read_callback(decoder, my_read_callback);</div>
<div class="line">FLAC__seekable_stream_decoder_set_seek_callback(decoder, my_seek_callback);</div>
<div class="line">FLAC__seekable_stream_decoder_set_tell_callback(decoder, my_tell_callback);</div>
<div class="line">FLAC__seekable_stream_decoder_set_length_callback(decoder, my_length_callback);</div>
<div class="line">FLAC__seekable_stream_decoder_set_eof_callback(decoder, my_eof_callback);</div>
<div class="line">FLAC__seekable_stream_decoder_set_write_callback(decoder, my_write_callback);</div>
<div class="line">FLAC__seekable_stream_decoder_set_metadata_callback(decoder, my_metadata_callback);</div>
<div class="line">FLAC__seekable_stream_decoder_set_error_callback(decoder, my_error_callback);</div>
<div class="line">FLAC__seekable_stream_decoder_set_client_data(decoder, my_client_data);</div>
<div class="line"><span class="keywordflow">if</span>(FLAC__seekable_stream_decoder_init(decoder) != FLAC__SEEKABLE_STREAM_DECODER_OK) do_something;</div>
<div class="ttc" id="aCarlaBridgeFormat_8cpp_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="CarlaBridgeFormat_8cpp.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition</b> CarlaBridgeFormat.cpp:30</div></div>
</div><!-- fragment --><p>In FLAC 1.1.3 it is like this:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structFLAC____StreamDecoder.html">FLAC__StreamDecoder</a> *decoder = <a class="code hl_function" href="group__flac__stream__decoder.html#ga8e25ac9f30480316dcd33f82c5a5812d">FLAC__stream_decoder_new</a>();</div>
<div class="line"><span class="keywordflow">if</span>(decoder == <a class="code hl_define" href="CarlaBridgeFormat_8cpp.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) do_something;</div>
<div class="line"><a class="code hl_function" href="group__flac__stream__decoder.html#ga48074d18a17ea88e8272cc8f865ae6e6">FLAC__stream_decoder_set_md5_checking</a>(decoder, <span class="keyword">true</span>);</div>
<div class="line">[... other settings ...]</div>
<div class="line"><span class="keywordflow">if</span>(<a class="code hl_function" href="group__flac__stream__decoder.html#ga32c28a56a2bdfa2333edbd3d991894d7">FLAC__stream_decoder_init_stream</a>(</div>
<div class="line">  decoder,</div>
<div class="line">  my_read_callback,</div>
<div class="line">  my_seek_callback,      <span class="comment">// or NULL</span></div>
<div class="line">  my_tell_callback,      <span class="comment">// or NULL</span></div>
<div class="line">  my_length_callback,    <span class="comment">// or NULL</span></div>
<div class="line">  my_eof_callback,       <span class="comment">// or NULL</span></div>
<div class="line">  my_write_callback,</div>
<div class="line">  my_metadata_callback,  <span class="comment">// or NULL</span></div>
<div class="line">  my_error_callback,</div>
<div class="line">  my_client_data</div>
<div class="line">) != <a class="code hl_enumvalue" href="group__flac__stream__decoder.html#ggaaed54a24ac6310d29c5cafba79759c44ac94c7e9396f30642f34805e5d626e011">FLAC__STREAM_DECODER_INIT_STATUS_OK</a>) do_something;</div>
<div class="ttc" id="agroup__flac__stream__decoder_html_ga32c28a56a2bdfa2333edbd3d991894d7"><div class="ttname"><a href="group__flac__stream__decoder.html#ga32c28a56a2bdfa2333edbd3d991894d7">FLAC__stream_decoder_init_stream</a></div><div class="ttdeci">FLAC_API FLAC__StreamDecoderInitStatus FLAC__stream_decoder_init_stream(FLAC__StreamDecoder *decoder, FLAC__StreamDecoderReadCallback read_callback, FLAC__StreamDecoderSeekCallback seek_callback, FLAC__StreamDecoderTellCallback tell_callback, FLAC__StreamDecoderLengthCallback length_callback, FLAC__StreamDecoderEofCallback eof_callback, FLAC__StreamDecoderWriteCallback write_callback, FLAC__StreamDecoderMetadataCallback metadata_callback, FLAC__StreamDecoderErrorCallback error_callback, void *client_data)</div></div>
<div class="ttc" id="agroup__flac__stream__decoder_html_ga48074d18a17ea88e8272cc8f865ae6e6"><div class="ttname"><a href="group__flac__stream__decoder.html#ga48074d18a17ea88e8272cc8f865ae6e6">FLAC__stream_decoder_set_md5_checking</a></div><div class="ttdeci">FLAC_API FLAC__bool FLAC__stream_decoder_set_md5_checking(FLAC__StreamDecoder *decoder, FLAC__bool value)</div></div>
<div class="ttc" id="agroup__flac__stream__decoder_html_ga8e25ac9f30480316dcd33f82c5a5812d"><div class="ttname"><a href="group__flac__stream__decoder.html#ga8e25ac9f30480316dcd33f82c5a5812d">FLAC__stream_decoder_new</a></div><div class="ttdeci">FLAC_API FLAC__StreamDecoder * FLAC__stream_decoder_new(void)</div></div>
<div class="ttc" id="agroup__flac__stream__decoder_html_ggaaed54a24ac6310d29c5cafba79759c44ac94c7e9396f30642f34805e5d626e011"><div class="ttname"><a href="group__flac__stream__decoder.html#ggaaed54a24ac6310d29c5cafba79759c44ac94c7e9396f30642f34805e5d626e011">FLAC__STREAM_DECODER_INIT_STATUS_OK</a></div><div class="ttdeci">@ FLAC__STREAM_DECODER_INIT_STATUS_OK</div><div class="ttdef"><b>Definition</b> stream_decoder.h:257</div></div>
<div class="ttc" id="astructFLAC____StreamDecoder_html"><div class="ttname"><a href="structFLAC____StreamDecoder.html">FLAC__StreamDecoder</a></div><div class="ttdef"><b>Definition</b> stream_decoder.h:462</div></div>
</div><!-- fragment --><p>or you could do;</p>
<div class="fragment"><div class="line">[...]</div>
<div class="line">FILE *<a class="code hl_variable" href="src_23rdparty_2jack2_2tests_2test_8cpp.html#a702945180aa732857b380a007a7e2a21">file</a> = fopen(<span class="stringliteral">&quot;somefile.flac&quot;</span>,<span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span>(<a class="code hl_variable" href="src_23rdparty_2jack2_2tests_2test_8cpp.html#a702945180aa732857b380a007a7e2a21">file</a> == <a class="code hl_define" href="CarlaBridgeFormat_8cpp.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) do_somthing;</div>
<div class="line"><span class="keywordflow">if</span>(<a class="code hl_function" href="group__flac__stream__decoder.html#ga38f9eb46bf112af205f86b4cbac9980c">FLAC__stream_decoder_init_FILE</a>(</div>
<div class="line">  decoder,</div>
<div class="line">  <a class="code hl_variable" href="src_23rdparty_2jack2_2tests_2test_8cpp.html#a702945180aa732857b380a007a7e2a21">file</a>,</div>
<div class="line">  my_write_callback,</div>
<div class="line">  my_metadata_callback,  <span class="comment">// or NULL</span></div>
<div class="line">  my_error_callback,</div>
<div class="line">  my_client_data</div>
<div class="line">) != <a class="code hl_enumvalue" href="group__flac__stream__decoder.html#ggaaed54a24ac6310d29c5cafba79759c44ac94c7e9396f30642f34805e5d626e011">FLAC__STREAM_DECODER_INIT_STATUS_OK</a>) do_something;</div>
<div class="ttc" id="agroup__flac__stream__decoder_html_ga38f9eb46bf112af205f86b4cbac9980c"><div class="ttname"><a href="group__flac__stream__decoder.html#ga38f9eb46bf112af205f86b4cbac9980c">FLAC__stream_decoder_init_FILE</a></div><div class="ttdeci">FLAC_API FLAC__StreamDecoderInitStatus FLAC__stream_decoder_init_FILE(FLAC__StreamDecoder *decoder, FILE *file, FLAC__StreamDecoderWriteCallback write_callback, FLAC__StreamDecoderMetadataCallback metadata_callback, FLAC__StreamDecoderErrorCallback error_callback, void *client_data)</div></div>
<div class="ttc" id="asrc_23rdparty_2jack2_2tests_2test_8cpp_html_a702945180aa732857b380a007a7e2a21"><div class="ttname"><a href="src_23rdparty_2jack2_2tests_2test_8cpp.html#a702945180aa732857b380a007a7e2a21">file</a></div><div class="ttdeci">FILE * file</div><div class="ttdef"><b>Definition</b> test.cpp:61</div></div>
</div><!-- fragment --><p>or just:</p>
<div class="fragment"><div class="line">[...]</div>
<div class="line"><span class="keywordflow">if</span>(<a class="code hl_function" href="group__flac__stream__decoder.html#ga1692108a97012d1c5f79baf7df012c33">FLAC__stream_decoder_init_file</a>(</div>
<div class="line">  decoder,</div>
<div class="line">  <span class="stringliteral">&quot;somefile.flac&quot;</span>,</div>
<div class="line">  my_write_callback,</div>
<div class="line">  my_metadata_callback,  <span class="comment">// or NULL</span></div>
<div class="line">  my_error_callback,</div>
<div class="line">  my_client_data</div>
<div class="line">) != <a class="code hl_enumvalue" href="group__flac__stream__decoder.html#ggaaed54a24ac6310d29c5cafba79759c44ac94c7e9396f30642f34805e5d626e011">FLAC__STREAM_DECODER_INIT_STATUS_OK</a>) do_something;</div>
<div class="ttc" id="agroup__flac__stream__decoder_html_ga1692108a97012d1c5f79baf7df012c33"><div class="ttname"><a href="group__flac__stream__decoder.html#ga1692108a97012d1c5f79baf7df012c33">FLAC__stream_decoder_init_file</a></div><div class="ttdeci">FLAC_API FLAC__StreamDecoderInitStatus FLAC__stream_decoder_init_file(FLAC__StreamDecoder *decoder, const char *filename, FLAC__StreamDecoderWriteCallback write_callback, FLAC__StreamDecoderMetadataCallback metadata_callback, FLAC__StreamDecoderErrorCallback error_callback, void *client_data)</div></div>
</div><!-- fragment --><p>Another small change to the decoder is in how it handles unparseable streams. Before, when the decoder found an unparseable stream (reserved for when the decoder encounters a stream from a future encoder that it can't parse), it changed the state to <code>FLAC__STREAM_DECODER_UNPARSEABLE_STREAM</code>. Now the decoder instead drops sync and calls the error callback with a new error code <code>FLAC__STREAM_DECODER_ERROR_STATUS_UNPARSEABLE_STREAM</code>. This is more robust. If your error callback does not discriminate on the the error state, your code does not need to be changed.</p>
<p>The encoder now has a new setting: <a class="el" href="group__flac__stream__encoder.html#ga83d38fd6fca7abbf8363bdc2536a299e">FLAC__stream_encoder_set_apodization()</a>. This is for setting the method used to window the data before LPC analysis. You only need to add a call to this function if the default is not suitable. There are also two new convenience functions that may be useful: <a class="el" href="group__flac__metadata__object.html#ga897138ca0a985d8741f73d6657f38845">FLAC__metadata_object_cuesheet_calculate_cddb_id()</a> and <a class="el" href="group__flac__metadata__level0.html#ga6ee2633dc179c2a0cb5fef5762faf0fd">FLAC__metadata_get_cuesheet()</a>.</p>
<p>The <em class="arg">bytes</em> parameter to <a class="el" href="group__flac__stream__decoder.html#ga25d4321dc2f122d35ddc9061f44beae7">FLAC__StreamDecoderReadCallback</a>, <a class="el" href="group__flac__stream__encoder.html#ga18b7941b93bae067192732e913536d44">FLAC__StreamEncoderReadCallback</a>, and <a class="el" href="group__flac__stream__encoder.html#ga50865125fd57c40fab6eb2f062651429">FLAC__StreamEncoderWriteCallback</a> is now <code>size_t</code> instead of <code>unsigned</code>. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
